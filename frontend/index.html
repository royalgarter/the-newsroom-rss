<!DOCTYPE html>
<html lang="en" class="scroll-smooth"> <!-- Added "dark" class here for initial dark mode, remove if you want light mode by default -->
	<head x-data="alpineHead()">
		<title x-html="title">The Newsroom RSS</title>

		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width">
		<meta name="color-scheme" content="light dark">
		<meta name="description" :content="description" content="We just decided: The first step in fixing the world is to Be Informed. Get curated news, delivered your way: fast, personalized RSS.">
		<meta name="keyworks" content="news, rss, feed, aggregator, reader, alpinejs, tailwindcss">

		<link rel="canonical" :href="host">
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
		<link rel="manifest" href="/manifest.json">

		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

		<meta name="theme-color" content="#2b7fff">
		<meta name="application-name" :content="title" content="The Newsroom RSS">
		<meta name="msapplication-TileColor" content="#fefefe">
		<meta name="apple-mobile-web-app-status-bar-style" content="#2b7fff">
		<meta name="apple-mobile-web-app-title" :content="title">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="mobile-web-app-capable" content="yes">
		<meta property="og:title" :content="title" content="The Newsroom RSS">
		<meta property="og:description" :content="description" content="We just decided: The first step in fixing the world is to Be Informed. Get curated news, delivered your way: fast, personalized RSS.">
		<meta property="og:image" :content="host + '/screenshots/the-newsroom-rss_600x315.png'" content="/screenshots/the-newsroom-rss_600x315.png">
		<meta property="og:image:secure_url" :content="host + '/screenshots/the-newsroom-rss_600x315.png'" content="/screenshots/the-newsroom-rss_600x315.png">
		<meta property="og:image:alt" :content="host + '/screenshots/the-newsroom-rss_600x315.png'">
		<meta property="og:image:width" content="600">
		<meta property="og:image:height" content="315">
		<meta property="og:url" :content="host + ''">
		<meta property="og:type" content="website">
		<meta property="og:locale" content="en_US">
		<meta property="og:site_name" :content="title" content="The Newsroom RSS">
		<meta name="twitter:title" :content="title" content="The Newsroom RSS">
		<meta name="twitter:description" :content="description" content="We just decided: The first step in fixing the world is to Be Informed. Get curated news, delivered your way: fast, personalized RSS.">
		<meta name="twitter:url" :content="host + ''">
		<meta name="twitter:image" :content="host + '/screenshots/the-newsroom-rss_600x315.png'">
		<meta name="twitter:card" content="summary">
		<meta name="twitter:creator" content="@royalgarter">

		<link rel="preload" as="script" href="//unpkg.com/@tailwindcss/browser@4" />
		<link rel="preload" as="script" href="//cdnjs.cloudflare.com/ajax/libs/alpinejs-intersect/3.14.8/cdn.min.js" />
		<link rel="preload" as="script" href="//cdnjs.cloudflare.com/ajax/libs/alpinejs/3.14.8/cdn.min.js" />
		<link rel="preload" as="script" href="//cdnjs.cloudflare.com/ajax/libs/readability/0.5.0/Readability.min.js" />
		<link rel="preload" as="script" href="//cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.min.js" />

		<script async src="//unpkg.com/@tailwindcss/browser@4"></script>
		<script defer src="//cdnjs.cloudflare.com/ajax/libs/alpinejs-intersect/3.14.8/cdn.min.js"></script>
		<script defer src="//cdnjs.cloudflare.com/ajax/libs/alpinejs/3.14.8/cdn.min.js"></script>
		<script defer src="//cdnjs.cloudflare.com/ajax/libs/readability/0.5.0/Readability.min.js"></script>
		<script src="//cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.min.js"></script>

		<!-- <script src="//cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script> -->
		<!-- <script src="//cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder"></script> -->
	</head>
	<body x-cloak x-data="alpineRSS()" class="bg-gray-50 dark:bg-gray-900 min-h-screen flex flex-col">
		<template x-if="ready">
			<header class="bg-blue-600 dark:bg-blue-800 p-4 text-stone-100 text-center flex items-center justify-between max-w-auto">
				<a href="/#title" name="title" class="mx-auto pl-6 text-center">
					<h1 :class="loading ? 'animate-pulse italic' : ''" class="text-2xl font-bold"
						x-html="title">
					</h1>
				</a>
				<ul class="pt-1">
					<li>
						<button class="rounded-md focus:outline-none focus:shadow-outline-purple" @click="toggleDarkMode()" aria-label="Toggle Dark Mode">
							<template x-if="!dark">
								<svg class="size-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20">
									<path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
								</svg>
							</template>
							<template x-if="dark">
								<svg class="size-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20">
									<path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
								</svg>
							</template>
						</button>
					</li>
				</ul>
			</header>
		</template>
		<main class="container mx-auto p-2 flex-1">
			<div class="flex gap-4 items-center mb-4 justify-self-center">
				<span x-show="error" class="text-red-500" x-text="error"></span>
			</div>

			<!-- rss-feed -->
			<template x-for="(feed, index) in feeds" :key="index">
				<section class="rss-feed bg-white dark:bg-gray-800 rounded mb-4"
					:class="params?.style?.includes?.('shadow') ? 'shadow' : ''"
					x-cloak x-show="feed?.items?.length > 0"
					x-intersect:once="feed.items.forEach(x => x.prefetchContent?.())"
				>
					<span class="relative flex size-2" :class="loading ? 'visible' : 'invisible'">
						<span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-orange-400 opacity-75"></span>
						<span class="relative inline-flex size-2 rounded-full bg-orange-500"></span>
					</span>
					<a :name="feed.anchor" :href="('#' + feed.anchor) || feed.link || feed.rss_url" target="_blank">
						<span class="inline-flex items-baseline pt-5 sm:pt-4 md:pt-8 px-5 sm:px-4 md:px-8">
							<img class="self-center size-6 mr-2 md:mr-4"
								:src="'https://www.google.com/s2/favicons?domain=' + new URL(feed.link).hostname +'&sz=128'"
								onerror="this.src = '/favicons/ios/128.png';"
								/>
							<h2 class="text-indigo-950 dark:text-indigo-200 text-xl font-bold mx-auto"
								x-text="feed.short || feed.title"></h2>
						</span>
					</a>
					<div class="max-w-screen-2xl mx-auto p-3 sm:p-8 md:p-10">
						<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-6 gap-6">
							<!-- rss-item -->
							<template x-for="(item, itemIndex) in feed.items" :key="itemIndex">
								<div class="rss-item bg-slate-50 dark:bg-slate-700 rounded overflow-hidden"
									x-intersect:enter="triggerIntersect('enter', item.link)"
									x-intersect:leave="triggerIntersect('leave', item.link)"
									x-intersect.full="triggerIntersect('full', item.link)"
									:class="item.viewed && 'opacity-90 italic'"
									:class="params?.style?.includes?.('shadow') ? 'shadow' : ''"
								>
									<!-- thumbnail -->
									<template x-if="!params?.style?.includes?.('no') && item.images?.[0]?.length">
										<div class="rss-meta relative min-h-36">
											<a class="rss-thumb" :href="item.link" target="_blank">
												<link rel="prefetch" as="image" :href="item.images[0]" />
												<img class="rss-thumb w-full min-h-36 max-h-[320px]"
													:loading="index <= 1 ? 'eager' : 'lazy'"
													:fetchpriority="index <= 1 ? 'high' : 'low'"
													:src="item.images[0]"
													:alt="item.title"
													:domain="new URL(feed.link).hostname"
													onerror="this.src = 'https://www.google.com/s2/favicons?domain=' + this.getAttribute('domain') +'&sz=256';"
												/>
												<div
													class="hover:bg-transparent transition duration-300 absolute bottom-0 top-0 right-0 left-0 bg-gray-900 opacity-25">
												</div>
											</a>
											<a class="rss-tags" x-show="item.author?.length" :href="item.link_author || item.link" target="_blank">
												<div class="absolute bottom-0 left-0 bg-indigo-600 dark:bg-indigo-400 px-4 py-2 text-white dark:text-gray-900 text-sm hover:bg-white dark:hover:bg-gray-700 hover:text-indigo-600 dark:hover:text-indigo-200 transition duration-500 ease-in-out"
													x-html="item.author?.toString().substr(0, 12).trim()">
												</div>
											</a>

											<a class="rss-author" :href="item.link" target="_blank">
												<div class="text-xs p-2 h-12 w-12 absolute top-0 right-0 bg-indigo-600 dark:bg-indigo-400 text-white dark:text-gray-900 rounded-full flex flex-col items-center justify-center mt-3 mr-2 hover:bg-white dark:hover:bg-gray-700 hover:text-indigo-600 dark:hover:text-indigo-200 transition duration-500 ease-in-out">
													<small class="break-words text-center"
														x-html="
															(timeSince(new Date(item.published)) + ' ago')
															|| new Date(item.published).toString().split(' GMT').shift()
															|| (item.categories?.join(', ') || item.statistics || feed.short).substr(0, 30).trim()
														">
													</small>
												</div>
											</a>
										</div>
									</template>
									<!-- title & description -->
									<div class="p-4 text-gray-400 dark:text-gray-300">
										<span x-show="item.viewed" class="py-1 text-xs font-regular mr-1 flex flex-row items-center">
											<svg x-cloak xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
												<path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88" />
											</svg>
											<span class="ml-1" x-text="item.viewed"></span>
										</span>

										<a class="rss-title font-semibold text-lg mb-2 inline-block hover:text-indigo-600 dark:hover:text-indigo-300 visited:text-fuchsia-800 transition duration-500 ease-in-out"
											:class="(item.images?.[0]?.length && !params?.style?.includes?.('title')) ? 'pointer-events-none' : ''"
											:href="item.link" target="_blank"
											x-html="decodeHTML(item.title) + (
														params?.style?.includes?.('title')
															? (' <sup class=&quot;text-xs text-gray-400 dark:text-gray-300 font-light&quot;>[' + timeSince(new Date(item.published)) + ']</sup>')
															: ''
													)"
										>
										</a>
										<template x-if="!params?.style?.includes?.('title')">
											<p class="rss-desc text-gray-500 dark:text-gray-400 text-sm whitespace-pre-line break-words"
												x-html="item.description ? decodeHTML(item.description) : ''"
											>
											</p>
										</template>
									</div>
									<!-- item article -->
									<template x-if="!params?.style?.includes?.('title')">
										<div :id="'rss-item-article-' + index + '-' + itemIndex">
											<div :class="item.article ? 'visible' : 'invisible'" @click="item.toggleReadmore()" class="cursor-pointer px-4 py-2 flex flex-row items-center">
												<span :class="item.read_more ? 'text-fuchsia-600' : 'text-teal-600'" class="py-1 text-xs font-regular flex flex-row items-center">
													<svg x-cloak x-show="!item.read_more" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
													  <path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h14.25M3 9h9.75M3 13.5h9.75m4.5-4.5v12m0 0-3.75-3.75M17.25 21 21 17.25" />
													</svg>
													<svg x-cloak x-show="item.read_more" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
														<path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h14.25M3 9h9.75M3 13.5h5.25m5.25-.75L17.25 9m0 0L21 12.75M17.25 9v12" />
													</svg>
													<span class="ml-1" x-text="item.read_more ? 'Collapse' : 'Preview'"></span>
												</span>
											</div>
											<template x-if="item.read_more">
												<div :class="item.read_more ? 'block' : 'hidden'"
													class="block sm:hidden px-4 py-2 flex flex-row items-center bg-amber-50 dark:bg-stone-800 transition-all transition-discrete"
													x-intersect:leave="false && (item.read_more = false)"
												>
													<span class="py-1 text-xs font-regular text-gray-600 dark:text-gray-300 flex flex-row items-center">
														<p class="rss-article-content text-gray-500 dark:text-gray-400 text-sm whitespace-pre-line break-words" x-html="item.article?.content || ''">
														</p>
													</span>
												</div>
											</template>
										</div>
									</template>
								</div>
							</template>
						</div>

						<!-- feed article -->
						<template x-if="feed.read_more && feed.article">
							<div :id="'rss-feed-article-' + index" x-show="feed.read_more && feed.article"
								:class="params?.style?.includes?.('shadow') ? 'shadow' : ''"
								class="hidden sm:block pt-4 grid grid-cols-1 gap-6 transition-all transition-discrete"
								x-intersect:leave="false && feed.read_more && feed.article && feed.read_more_item?.toggleReadmore()"
							>
								<div class="rounded overflow-hidden bg-amber-50 dark:bg-stone-800" :class="params?.style?.includes?.('shadow') ? 'shadow' : ''">
									<div class="px-4 py-2 flex flex-row items-center">
										<span class="py-1 text-xl font-bold flex flex-row items-center">
											<p class="rss-article-title text-gray-600 dark:text-gray-300 whitespace-pre-line break-words" x-html="feed.article?.title || ''">
											</p>
										</span>
									</div>
									<div class="px-4 py-2 flex flex-row items-center">
										<span class="py-1 text-sm font-regular flex flex-row items-center">
											<p class="rss-article-content text-gray-500 dark:text-gray-400 whitespace-pre-line break-words" x-html="feed.article?.content || ''">
											</p>
										</span>
									</div>
									<div @click="feed.read_more_item.toggleReadmore()" class="cursor-pointer p-2 flex flex-row items-center float-right">
										<span class="p-3 text-xs font-regular text-fuchsia-950 dark:text-fuchsia-200 flex flex-row items-center">
											<svg x-cloak xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-8">
											  <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 18.75 7.5-7.5 7.5 7.5" />
											  <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 7.5-7.5 7.5 7.5" />
											</svg>
										</span>
									</div>
								</div>
							</div>
						</template>
					</div>
				</section>
			</template>

			<!-- rss-configuration -->
			<div class="divide-y divide-slate-200 dark:divide-gray-700">
				<!-- rss-settings -->
				<div x-data="{
						expanded: (document.querySelectorAll('.rss-task-item').length == 0)
					}"
					class="py-2">
					<h3 class="text-xl">
						<button
							id="collapse-title-01"
							type="button"
							class="cursor-pointer text-slate-600 dark:text-slate-300 flex items-center justify-between w-full text-left font-semibold py-2"
							@click="expanded = !expanded"
							:aria-expanded="expanded"
							aria-controls="collapse-text-01"
						>
							<span x-html="'Your RSS Feeds' + (tasks?.length ? ' [' + tasks.length + ']' : '') + (loading ? ' is loading' : '')"></span>
							<svg x-cloak class="fill-indigo-500 dark:fill-indigo-300 shrink-0 ml-8" width="16" height="16" xmlns="http://www.w3.org/2000/svg">
								<rect y="7" width="16" height="2" rx="1" class="transform origin-center transition duration-200 ease-out" :class="{'!rotate-180': expanded}" />
								<rect y="7" width="16" height="2" rx="1" class="transform origin-center rotate-90 transition duration-200 ease-out" :class="{'!rotate-180': expanded}" />
							</svg>
						</button>
					</h3>
					<!-- rss-review-item -->
					<template x-if="review_feed">
						<section class="rss-feed bg-white dark:bg-gray-800 rounded mb-4 italic opacity-90">
							<a :name="review_feed.anchor" :href="review_feed.rss_url" target="_blank">
								<span class="inline-flex items-baseline pt-5 sm:pt-4 md:pt-8 px-5 sm:px-4 md:px-8">
									<img class="self-center size-6 mr-2 md:mr-4"
										:src="'https://www.google.com/s2/favicons?domain=' + new URL(review_feed.link).hostname +'&sz=128'"
										onerror="this.src = '/favicons/ios/128.png';"
										/>
									<h2 class="text-indigo-900 dark:text-indigo-200 font-bold mx-auto truncate"
										x-text="'[REVIEW] ' + review_feed.rss_url"></h2>
								</span>
							</a>
							<div class="max-w-screen-2xl mx-auto p-3 sm:p-8 md:p-10">
								<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-6 gap-6">
									<!-- rss-item -->
									<template x-for="(item, itemIndex) in review_feed.items" :key="itemIndex">
										<div class="rss-item bg-slate-50 dark:bg-slate-800 rounded overflow-hidden">
											<!-- thumbnail -->
											<template x-if="item.images?.[0]?.length">
												<div class="rss-meta relative min-h-[240px]">
													<link rel="prefetch" as="image" :href="item.images[0]" />
													<img class="rss-thumb w-full min-h-24 max-h-[240px]"
														:loading="index <= 1 ? 'eager' : 'lazy'"
														:fetchpriority="index <= 1 ? 'high' : 'low'"
														:src="item.images[0]"
														:alt="item.title"
														:domain="new URL(review_feed.link).hostname"
														onerror="this.src = 'https://www.google.com/s2/favicons?domain=' + this.getAttribute('domain') +'&sz=256';"
													/>
													<div
														class="transition duration-300 absolute bottom-0 top-0 right-0 left-0 bg-gray-900 opacity-25">
													</div>
													<div class="absolute bottom-0 left-0 bg-indigo-600 dark:bg-indigo-400 px-4 py-2 text-white dark:text-gray-900 text-sm transition duration-500 ease-in-out"
														x-html="(timeSince(new Date(item.published)) + ' ago')
															|| new Date(item.published).toString().split(' GMT').shift()
															|| (item.categories?.join(', ') || item.statistics || review_feed.short).substr(0, 30).trim()
													">
													</div>
												</div>
											</template>
											<!-- title & description -->
											<div class="p-4">
												<p class="rss-title font-semibold text-lg mb-2 inline-block text-indigo-800 dark:text-indigo-300 hover:text-indigo-600 dark:hover:text-indigo-200 transition duration-500 ease-in-out" x-html="item.title"></p>
												<p class="rss-desc text-indigo-400 dark:text-indigo-500 text-sm whitespace-pre-line break-words" x-html="item.description || ''"></p>
											</div>
									</template>
								</div>
							</div>
						</section>
					</template>

					<div
						id="collapse-text-01"
						role="region"
						aria-labelledby="collapse-title-01"
						class="grid text-sm text-slate-600 dark:text-slate-300 overflow-hidden transition-all duration-300 ease-in-out"
						:class="expanded ? 'grid-rows-[1fr] opacity-100' : 'grid-rows-[0fr] opacity-0'"
						>
						<div class="overflow-hidden">
							<div class="w-full">
								<template x-if="ready">
									<div class="m-auto my-4 max-w-auto rounded-md bg-gray-300 dark:bg-gray-700">
										<!-- Input -->
										<div class="text-lg bg-blue-500 dark:bg-blue-700 p-4 rounded-t-md flex relative justify-around">
											<form @submit.prevent="addNewTask" class="min-w-9/10">
												<input
													x-on:input.change.debounce.300ms='reviewTask()'
													x-model="input"
													class="w-full bg-blue-500 dark:bg-blue-700 italic text-base text-white placeholder-gray-200 focus:outline-none border-b-2"
													placeholder=" Enter new RSS feed URL..."
												/>
											</form>
											<svg x-cloak xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-6 text-white mt-2 ml-3 cursor-pointer" @click="addNewTask">
												<path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
											</svg>
										</div>

										<!-- List -->
										<div class="p-3">
											<span x-show="tasks.length <= 0" class="center italic text-gray-400 dark:text-gray-500 px-2">
												<p>RSS is <strong>Really Simple Syndication</strong>, allows to access updates to websites in a standardized format, e.g: </p>
												<ul class="ml-6 my-2 list-disc">
													<template x-for="(d, idxDf) in K.DEFAULTS" :key="idxDf">
														<li><p x-html="d" class="break-words overflow-wrap text-wrap"></p></li>
													</template>
												</ul>
											</span>

											<div @drop.prevent="
												if (drag !== null && drop !== null) {
													if (drag < drop)
														tasks = [
															...tasks.slice(0, drag),
															...tasks.slice(drag + 1, drop + 1),
															tasks[drag],
															...tasks.slice(drop + 1)
														];
													else
														tasks = [
															...tasks.slice(0, drop),
															tasks[drag],
															...tasks.slice(drop, drag),
															...tasks.slice(drag + 1)
														];
													storageSet(K.tasks, tasks);
												};
												drop = null;
												"
												@dragover.prevent="$event.dataTransfer.dropEffect = 'move'"
											>
												<template x-for="(item, index) in tasks" :key="index">
													<div class="rss-task-item p-2 bg-gray-200 dark:bg-gray-600 mt-2 rounded flex items-center relative"
														:class="{'bg-blue-300 dark:bg-blue-500': drag === index}"
														style="overflow-wrap: anywhere;"
														draggable="true" @dragstart="drag = index" @dragend="drag = null"
													>
														<svg x-cloak xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-4 ml-1 mr-2">
															<path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z" />
														</svg>
														<div class="mx-2">
															<a :href="item.url" target="_blank"><span x-text="item.url"></span></a>
														</div>
														<svg x-cloak xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor"
															class="size-3 cursor-pointer text-red-500"
															@click="tasks.splice(index, 1);storageSet(K.tasks, tasks);"
														>
															<path stroke-linecap="round" stroke-linejoin="round" d="M13.181 8.68a4.503 4.503 0 0 1 1.903 6.405m-9.768-2.782L3.56 14.06a4.5 4.5 0 0 0 6.364 6.365l3.129-3.129m5.614-5.615 1.757-1.757a4.5 4.5 0 0 0-6.364-6.365l-4.5 4.5c-.258.26-.479.541-.661.84m1.903 6.405a4.495 4.495 0 0 1-1.242-.88 4.483 4.483 0 0 1-1.062-1.683m6.587 2.345 5.907 5.907m-5.907-5.907L8.88 8.898M2.991 2.99 8.898 8.9" />
														</svg>

														<div class="absolute inset-0 opacity-50"
															:class="{'bg-blue-200 dark:bg-blue-400': drop === index}"
															x-show.transition="drag !== null"
															@dragenter.prevent="if (index !== drag) {drop = index}"
															@dragleave="if (drop === index) drop = null"
														></div>
													</div>
												</template>
											</div>

										</div>

										<!-- Buttons -->
										<div class="bg-blue-500 dark:bg-blue-700 p-3 flex justify-end rounded-b-md space-x-4">
											<button
												class="cursor-pointer focus:outline-none uppercase text-xs text-blue-100 border-none bg-purple-600 dark:bg-purple-800 p-2 font-bold rounded shadow"
												x-show="tasks.length == 0"
												@click="importDefaults()"
											>
												Import Sample RSS
											</button>
											<button
												class="cursor-pointer focus:outline-none uppercase text-xs text-blue-100 border-none bg-rose-600 dark:bg-rose-800 p-2 font-bold rounded shadow"
												x-show="tasks.length > 0"
												@click="clearAllTasks()"
											>
												Clear All
											</button>
											<button
												class="cursor-pointer focus:outline-none uppercase text-xs text-blue-100 border-none bg-emerald-500 dark:bg-emerald-700 p-2 font-bold rounded shadow"
												x-show="tasks.length > 0"
												@click="exportTasks()"
											>
												Export CSV
											</button>
											<button
												class="cursor-pointer focus:outline-none uppercase text-xs text-blue-100 border-none bg-emerald-600 dark:bg-emerald-800 p-2 font-bold rounded shadow"
												x-show="tasks.length > 0"
												@click="buildTasks()"
											>
												Build Feeds
											</button>
										</div>
									</div>
								</template>


								<div class="rounded-lg overflow-hidden bg-gray-300 dark:bg-gray-700">
									<div id='json-editor' class="px-4 py-2"></div>
									<div class="bg-blue-500 dark:bg-blue-700 px-4 py-3 sm:px-6 flex justify-end">
										<button id='json-editor-submit' class="cursor-pointer focus:outline-none uppercase text-xs text-blue-100 border-none bg-emerald-600 dark:bg-emerald-800 p-2 font-bold rounded shadow">
											Saved
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- rss-declarations -->
				<div x-data="{ expanded: false }" class="py-2">
					<h3 class="text-xl">
						<button
							id="collapse-title-02"
							type="button"
							class="cursor-pointer text-slate-600 dark:text-slate-300 flex items-center justify-between w-full text-left font-semibold py-2"
							@click="expanded = !expanded"
							:aria-expanded="expanded"
							aria-controls="collapse-text-02"
						>
							<span>Why You Need RSS in Your Life</span>
							<svg x-cloak class="fill-indigo-500 dark:fill-indigo-300 shrink-0 ml-8" width="16" height="16" xmlns="http://www.w3.org/2000/svg">
								<rect y="7" width="16" height="2" rx="1" class="transform origin-center transition duration-200 ease-out" :class="{'!rotate-180': expanded}" />
								<rect y="7" width="16" height="2" rx="1" class="transform origin-center rotate-90 transition duration-200 ease-out" :class="{'!rotate-180': expanded}" />
							</svg>
						</button>
					</h3>
					<div
						id="collapse-text-02"
						role="region"
						aria-labelledby="collapse-title-02"
						class="grid text-sm text-slate-600 dark:text-slate-300 overflow-hidden transition-all duration-300 ease-in-out"
						:class="expanded ? 'grid-rows-[1fr] opacity-100' : 'grid-rows-[0fr] opacity-0'"
						>
						<div class="overflow-hidden">
							<div class="w-full">
								<div class="m-auto my-4 p-2 max-w-auto rounded-md bg-gray-100 dark:bg-gray-800">
									<!--  uses radio buttons -->
									<section class="flex flex-row flex-wrap m-4 py-4 rounded-lg">
										<input id="tab-one" type="radio" name="tabs" class="cursor-pointer peer/tab-one opacity-0 absolute" checked />
										<label for="tab-one" class="bg-slate-200 dark:bg-slate-700 hover:bg-stone-200 dark:hover:bg-stone-600 peer-checked/tab-one:bg-stone-200 dark:peer-checked/tab-one:bg-stone-600 text-lg font-semibold cursor-default px-2 py-1 rounded-tl-lg block">
											Fantastic RSS
										</label>

										<input id="tab-two" type="radio" name="tabs" class="cursor-pointer peer/tab-two opacity-0 absolute" />
										<label for="tab-two" class="bg-slate-300 dark:bg-slate-600 hover:bg-stone-200 dark:hover:bg-stone-600 peer-checked/tab-two:bg-stone-200 dark:peer-checked/tab-two:bg-stone-600 text-lg font-semibold cursor-default px-2 py-1 block">
											by Will McAvoy
										</label>

										<input id="tab-three" type="radio" name="tabs" class="cursor-pointer peer/tab-three opacity-0 absolute" />
										<label for="tab-three" class="bg-slate-400 dark:bg-slate-500 hover:bg-stone-200 dark:hover:bg-stone-600 peer-checked/tab-three:bg-stone-200 dark:peer-checked/tab-three:bg-stone-600 text-lg font-semibold cursor-default px-2 py-1 block">
											, Charlie Skinner
										</label>

										<input id="tab-four" type="radio" name="tabs" class="cursor-pointer peer/tab-four opacity-0 absolute" />
										<label for="tab-four" class="bg-slate-500 dark:bg-slate-400 hover:bg-stone-200 dark:hover:bg-stone-600 peer-checked/tab-four:bg-stone-200 dark:peer-checked/tab-four:bg-stone-600 text-lg font-semibold cursor-default px-2 py-1 rounded-tr-lg block">
											& Where To Find Them
										</label>

										<div class="basis-full h-0"></div>

										<div class="bg-stone-200 dark:bg-stone-600 hidden peer-checked/tab-one:block p-2 w-full transition-all transition-discrete">
											<div class="container mx-auto p-6 max-w-4xl">
												<p class="text-base mb-4">
													<strong class="font-bold">Reclaim Your Internet: Why You Need RSS in Your Life</strong>
												</p>
												<p class="text-base mb-4">Tired of endless scrolling, clickbait, and algorithms dictating what you see online? As a seasoned news professional, I've seen firsthand how the internet has changed. But amidst the noise, a powerful tool remains: RSS.</p>
												<p class="text-base mb-4">RSS (Really Simple Syndication) is your personal internet concierge. Instead of visiting countless websites, RSS brings the content <em class="italic">you</em> want directly to you. Imagine a single, customizable feed filled with the latest articles, blog posts, and videos from your favorite sources. No ads, no distractions, just the information you need, when you need it. </p>
												<p class="text-base mb-4">
													<strong class="font-bold">Here's why you should embrace RSS:</strong>
												</p>
												<ul class="list-disc pl-6 mb-4">
													<li class="mb-2">
														<strong class="font-bold">Time is precious:</strong> Stop wasting hours hopping between websites. RSS delivers updates in a clean, efficient format, saving you valuable time.
													</li>
													<li class="mb-2">
														<strong class="font-bold">Control your information:</strong> Algorithms push content based on assumptions. RSS puts <em class="italic">you</em> in control. Subscribe to the sources you trust, and filter out the rest.
													</li>
													<li class="mb-2">
														<strong class="font-bold">Stay informed, truly informed:</strong> Break free from echo chambers. RSS allows you to curate a diverse range of perspectives, fostering a more well-rounded understanding of the world.
													</li>
													<li class="mb-2">
														<strong class="font-bold">Rediscover the open web:</strong> Support independent creators and niche publications. RSS connects you directly to the sources you value, bypassing social media gatekeepers.
													</li>
													<li class="mb-2">
														<strong class="font-bold">It's easier than you think:</strong> Numerous user-friendly RSS readers are available for your computer, phone, or tablet. A quick search will reveal the perfect option for you.
													</li>
												</ul>
												<p class="text-base mb-4">In a world of information overload, RSS is a lifeline. It's a tool for reclaiming your attention, fostering informed citizenship, and connecting with the content that truly matters. Don't let the algorithms win. Take control of your internet experience and discover the power of RSS. You won't regret it.</p>
											</div>
										</div>
										<div class="bg-stone-200 dark:bg-stone-600 hidden peer-checked/tab-two:block p-2 w-full transition-all transition-discrete">
											<div class="container mx-auto p-6 max-w-4xl">
												<p class="text-base mb-4">
													<strong class="font-bold">(Clears throat)</strong>
												</p>
												<p class="text-base mb-4">Good evening. Tonight, I want to talk about something that may seem… arcane. Something that might not trend on Twitter, but that, in its own quiet way, is essential to an informed citizenry. I'm speaking, of course, about RSS.</p>
												<p class="text-base mb-4">
													<strong class="font-bold">(A hint of exasperation flickers)</strong>
												</p>
												<p class="text-base mb-4">Yes, RSS. I can practically hear the collective groan. But before you reach for the remote, consider this: In an age of disinformation, of algorithm-driven echo chambers, RSS offers a path to a more… curated, dare I say, <em class="italic">civilized</em> consumption of information. </p>
												<p class="text-base mb-4">
													<strong class="font-bold">(A touch of passion)</strong>
												</p>
												<p class="text-base mb-4">It's a simple concept, really. Instead of passively accepting whatever Facebook or Google deems worthy of your attention, RSS allows you to actively select your sources. It's like building your own bespoke news feed, tailored to your interests, your values, your intellectual curiosity.</p>
												<p class="text-base mb-4">
													<strong class="font-bold">(A wry smile)</strong>
												</p>
												<p class="text-base mb-4">Think of it as the antidote to the outrage industrial complex. Instead of being bombarded with sensational headlines designed to provoke an emotional response, you can focus on substantive reporting, on thoughtful analysis, on the kind of journalism that actually… informs.</p>
												<p class="text-base mb-4">
													<strong class="font-bold">(A plea)</strong>
												</p>
												<p class="text-base mb-4">I know it's not as flashy as the latest viral video. It doesn't offer the instant gratification of a perfectly crafted meme. But RSS offers something far more valuable: control. Control over your information, control over your attention, control over your own intellectual development.</p>
												<p class="text-base mb-4">
													<strong class="font-bold">(Straightens up)</strong>
												</p>
												<p class="text-base mb-4">In a society increasingly defined by its ability to process and disseminate information, the ability to curate your own information stream is not merely a convenience, it's a civic responsibility. It's a way to resist the forces of ignorance and manipulation. It's a way to reclaim the promise of the internet as a tool for enlightenment.</p>
												<p class="text-base mb-4">
													<strong class="font-bold">(A hint of hope)</strong>
												</p>
												<p class="text-base mb-4">So, tonight, I urge you to consider RSS. It may not be the sexiest topic, but it is, I believe, a vital one. It's a small step, perhaps, but a step in the right direction. A step towards a more informed, a more engaged, a more… civilized society.</p>
											</div>
										</div>
										<div class="bg-stone-200 dark:bg-stone-600 hidden peer-checked/tab-three:block p-2 w-full transition-all transition-discrete">
											<div class="container mx-auto p-6 max-w-4xl">
												<p class="text-base mb-4">
													<strong class="font-bold">Goddammit, Use RSS! Are You People Trying to Stay Uncivilized?</strong>
												</p>
												<p class="text-base mb-4">Alright, listen up! I haven't got all day, and neither do you, unless you <em class="italic">enjoy</em> being spoon-fed drivel by Zuckerberg and his army of algorithm-pushing monkeys. I'm talking about RSS. Yes, RSS! The thing you millennials probably think is some kind of obscure bird disease. </p>
												<p class="text-base mb-4">This isn't some newfangled social media crap. This is a <em class="italic">tool</em>. A way to get real goddamn information without having to wade through a swamp of cat videos and Kardashian updates. Are you journalists, or trained seals? </p>
												<p class="text-base mb-4">
													<strong class="font-bold">Here's the deal, and listen close:</strong>
												</p>
												<ul class="list-disc pl-6 mb-4">
													<li class="mb-2">
														<strong class="font-bold">Time is Money, and You're Wasting Both:</strong> Stop clicking around like a bunch of caffeinated hamsters. RSS delivers the news you need, straight to your reader. No ads, no distractions, just the facts. It's called efficiency, people. Look it up.
													</li>
													<li class="mb-2">
														<strong class="font-bold">Think for Yourselves, For Christ's Sake:</strong> You're letting some computer program decide what's important? You're journalists! You're supposed to be skeptical! RSS lets you choose your sources, so you can actually, you know, <em class="italic">think</em> for yourselves.
													</li>
													<li class="mb-2">
														<strong class="font-bold">Get the Whole Story, Not Just the Sound Bites:</strong> The world is complicated. It's messy. You're not going to understand it by reading 140-character tweets. RSS lets you dig deeper, explore different perspectives, and actually, you know, <em class="italic">report</em>.
													</li>
													<li class="mb-2">
														<strong class="font-bold">Support Real Journalism, Not Just Corporate Garbage:</strong> There are still some good people out there, trying to do honest work. They need your support. RSS lets you connect directly with those sources, instead of lining the pockets of some soulless corporation.
													</li>
													<li class="mb-2">
														<strong class="font-bold">It's Not Rocket Science!</strong> Download an RSS reader. Paste in a URL. Boom! News. If you can't figure that out, you're in the wrong business.
													</li>
												</ul>
												<p class="text-base mb-4">Look, I'm not asking you to cure cancer. I'm asking you to use your goddamn brains. The internet is a powerful tool, but it can also make you stupid. RSS is the antidote. So get off your asses, download a reader, and start reading. The world isn't going to wait for you to catch up. Now get out of my office!</p>
											</div>
										</div>
										<div class="bg-stone-200 dark:bg-stone-600 hidden peer-checked/tab-four:block p-2 w-full transition-all transition-discrete">
											<div class="container mx-auto p-6 max-w-4xl">
												<p class="text-base mb-4">
													<strong class="font-bold">Easy Guide to Getting News from Your Favorite Paper with RSS</strong>
												</p>
												<p class="text-base mb-4">Want the latest headlines without constantly checking the website? Here's how to find the RSS feed:</p>
												<ul class="list-disc pl-6 mb-4">
													<li class="mb-2">
														<strong class="font-bold">Look for the RSS Icon:</strong> Some websites show a small RSS icon (looks like a radio signal) near articles or at the bottom of the page.
													</li>
													<li class="mb-2">
														<strong class="font-bold">Check the Website Directly:</strong> Browse the website's bottom (footer) or "Contact Us" page for links labeled "RSS," "Subscribe," or "Feeds."
													</li>
													<li class="mb-2">
														<strong class="font-bold">Search the Website:</strong> Use the site's search box and type "RSS feed."
													</li>
													<li class="mb-2">
														<strong class="font-bold">Google It:</strong> The easiest way! Search Google for "[ <em class="italic">Newspaper Name</em>] RSS feed". For example, "New York Times RSS feed."
													</li>
													<li class="mb-2">
														<strong class="font-bold">Copy the Link:</strong> Once you find the feed link (it'll look like a web address), copy it.
													</li>
													<li class="mb-2">
														<strong class="font-bold">That's it! Now you can see them!</strong>
													</li>
												</ul>
												<p class="text-base mb-4">
													<a class="text-blue-500 dark:text-blue-300 font-semibold" href="https://github.com/plenaryapp/awesome-rss-feeds/blob/master/README.md" target="_blank">Get some Awesome RSS Feeds in Collective Directory here</a>
												</p>
												<p class="italic text-base mb-4">
													<strong>Note:</strong> Some websites might not offer RSS feeds directly.
												</p>
											</div>
										</div>
									</section>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>
		<template x-if="ready">
			<footer class="bg-gray-300 dark:bg-gray-800 p-4 text-center text-sm text-stone-900 dark:text-stone-200">
				<blockquote class="m-2 text-base italic font-semibold">
					"In the Information Age, ignorance is a choice.", "It's not the news, it's HOW you get the news.", "We just decided to try to do it better."
				</blockquote>
				— <cite>Will McAvoy, The Newsroom by Aaron Sorkin</cite>
			</footer>
		</template>
	</body>
</html>

<style type="text/tailwindcss">
	[x-cloak] { display: none !important; }

	@custom-variant dark (&:where(.dark, .dark *));

	img {
		max-width: 100%;
		height: auto;
	}

	p [id*="readability-page"] svg {
		display: none;
	}

	p [id*="readability-page"] img {
		padding: 1rem 3rem;
		place-self: center;
	}

	p.rss-article-content > * {
		text-wrap: wrap;
		overflow-wrap: anywhere;
		max-width: 100%;
	}

	p.rss-article-content p {
		padding: 0.5rem 0rem;
	}

	p.rss-article-content img {
		padding: 1rem;
		place-self: center;
	}

	.card-title {
		@apply float-right;
	}
	.card-title > span {
		@apply hidden;
	}
	.card-body {
		@apply block items-center relative max-w-full;
	}
	.card-body row {
		@apply flex items-center relative max-w-full w-full;
	}
	.form-group {
		@apply px-3 py-4 text-base bg-gray-200 rounded flex items-center relative max-w-full;
	}
	.form-group label{
		@apply mr-2 font-bold w-1/5 flex items-center relative;
	}
	.form-group .form-control{
		@apply border bg-gray-50 focus:outline-none rounded max-w-full w-4/5 flex items-center relative text-center;
	}
	button.btn-secondary {
		@apply cursor-pointer focus:outline-none uppercase text-xs text-gray-100 border-none bg-blue-600 p-2 mx-2 font-bold rounded shadow;
	}
	.dark .form-group {
		@apply bg-gray-700;
	}
	.dark .form-group .form-control{
		@apply bg-gray-800;
	}
	.dark button.btn-secondary {
		@apply text-gray-800;
	}
</style>

<script>
function alpineHead() {
	return {
		title: 'The Newsroom RSS',
		description: 'We just decided: The first step in fixing the world is to Be Informed. Get curated news, delivered your way: fast, personalized RSS.',
		host: '//rss.phamthanh.me',
	}
};

function alpineRSS() {
	const VERSION = 'v2';

	return {
		title: 'The Newsroom RSS',
		version: VERSION,

		dark: false,
		ready: false,

		feeds: [],
		loading: false,
		error: null,
		params: {},

		input: '',
		tasks: [],
		drag: null,
		drop: null,

		review_feed: null,

		persona: null,

		editor_options: null,

		K: {
			LIMIT: 6,

			DEFAULTS: [
				'https://feeds.bbci.co.uk/news/rss.xml',
				'https://feeds.nbcnews.com/feeds/topstories',
				'https://www.business-standard.com/rss/latest.rss',
				'https://feeds.npr.org/1128/rss.xml',
				'https://www.espn.com/espn/rss/news',
			],

			viewed: VERSION + '_viewed_',
			tasks: VERSION + '_tasks_',
			feeds: VERSION + '_feeds_',
			cache: VERSION + '_cache_',
			hash: VERSION + '_hash_',
			style: VERSION + '_style_',

			noClientFetch: VERSION + '_ncf_',

			persona: VERSION + '_persona_',
		},

		TRIGGER: {
			LIMIT: 20e3, // time to read article
		},

		CACHE: {},

		storageSet(key, val) {
			return localStorage.setItem(key, JSON.stringify(val));
		},
		storageGet(key) {
			return JSON.parse(localStorage.getItem(key) || null);
		},
		storageDel(key) {
			return localStorage.removeItem(key);
		},

		theTitle() {
			const BREAKS = [
				"We'll be right back...",
				"We'll be back in a moment...",
				"We'll be back in 30s...",
				"Back in 5s! 5... 4... 3... 2...",
				"More after the break...",
				"Stay with us...",
			];

			const capitalize = s => s && String(s[0]).toUpperCase() + String(s).slice(1);

			let now = new Date();

			let hour = now.getHours();

			if (this.loading) return BREAKS[Math.floor(Math.random()*BREAKS.length)];

			if (hour >= 20 && hour <=21) {
				if (!this.dark) this.toggleDarkMode();

				return 'News Night' + (this.params?.hash ? ` with Mc${capitalize(this.params.hash)}` : '');
			}

			return 'The Newsroom RSS' + (this.params?.hash ? ` | ${this.params.hash}` : '');
		},

		async testLLM() {
			let list_sentences = [
				'Will it snow tomorrow?',
				'Recently a lot of hurricanes have hit the US',
				'Global warming is real',

				'An apple a day, keeps the doctors away',
				'Eating strawberries is healthy',

				'what is your age?',
				'How old are you?',
				'How are you?',

				'The dog bit Johnny',
				'Johnny bit the dog',

				'The cat ate the mouse',
				'The mouse ate the cat',
			];
			this.get_embeddings(list_sentences, (embeddings) => {
				let matrix = this.cosine_similarity_matrix(embeddings);

				console.log(embeddings)
				console.log(matrix)
			});
		},
		get_embeddings(list_sentences, callback) {
			use.load().then(model => {
				model.embed(list_sentences).then(embeddings => {
					callback(embeddings?.arraySync?.());
				});
			});
		},
		dot(a, b) {
			var hasOwnProperty = Object.prototype.hasOwnProperty;
			var sum = 0;
			for (var key in a) {
				if (hasOwnProperty.call(a, key) && hasOwnProperty.call(b, key)) {
					sum += a[key] * b[key]
				}
			}
			return sum
		},
		similarity(a, b) {
			var magnitudeA = Math.sqrt(this.dot(a, a));
			var magnitudeB = Math.sqrt(this.dot(b, b));
			if (magnitudeA && magnitudeB)
				return this.dot(a, b) / (magnitudeA * magnitudeB);
			else return false
		},
		cosine_similarity_matrix(matrix) {
			let cosine_similarity_matrix = [];
			for (let i = 0; i < matrix.length; i++) {
				let row = [];
				for (let j = 0; j < i; j++) {
					row.push(cosine_similarity_matrix[j][i]);
				}
				row.push(1);
				for (let j = (i + 1); j < matrix.length; j++) {
					row.push(this.similarity(matrix[i], matrix[j]));
				}
				cosine_similarity_matrix.push(row);
			}
			return cosine_similarity_matrix;
		},
		calculateMeanVector(vectors) {
			if (!vectors || vectors.length === 0) {
				return null; // Handle empty input
			}

			const numVectors = vectors.length;
			const vectorLength = vectors[0].length;

			// Check for consistent vector lengths and valid data types
			for (let i = 1; i < numVectors; i++) {
				if (vectors[i].length !== vectorLength) {
					return null; // Handle inconsistent vector lengths
				}
			}

			for (let i = 0; i < numVectors; i++) {
				for (let j = 0; j < vectorLength; j++) {
					if (typeof vectors[i][j] !== 'number' || isNaN(vectors[i][j])) {
						return null; // Handle non-numeric data
					}
				}
			}

			// Calculate the sum of each component
			const sumVector = new Array(vectorLength).fill(0);
			for (let i = 0; i < numVectors; i++) {
				for (let j = 0; j < vectorLength; j++) {
					sumVector[j] += vectors[i][j];
				}
			}

			// Calculate the mean for each component
			const meanVector = sumVector.map(sum => sum / numVectors);

			return meanVector;
		},
		updateMeanVector(mean, numVectors, newVector, weight=1) {
			if (!mean || numVectors <= 0 || !newVector ) {
				console.log('Handle invalid input')
				return null;
			}

			const vectorLength = mean.length;

			if (newVector.length !== vectorLength) {
				console.log('Handle inconsistent vector lengths', newVector.length, vectorLength, mean)
				return null;
			}

			// Check for valid data types (numbers) in mean and newVector
			for (let i = 0; i < vectorLength; i++) {
				if (typeof mean[i] !== 'number' || isNaN(mean[i])
					|| typeof newVector[i] !== 'number' || isNaN(newVector[i])) {
					console.log('Handle non-numeric data')
					return null;
				}
			}

			const newNumVectors = numVectors + weight;
			const updatedMean = mean.map((meanComponent, index) => {
				return ((meanComponent * numVectors) + (newVector[index] * weight)) / newNumVectors;
			});

			return updatedMean;
		},

		triggerIntersect(type, link) {
			if (!link) return console.log('ELINK');

			let trig = this.TRIGGER[link] || {};

			let now = new Date();

			switch (type) {
				case 'full'://case 'enter':
					trig.tic = Math.min(now, trig.tic || now);
				break;
				case 'leave':
					trig.toc = Math.max(now, trig.toc || now);
					// trig.tic = Math.min(trig.toc, trig.tic || now);

					if (trig.tic && trig.toc) {
						let delta = trig.toc - trig.tic;

						trig.sum = trig.sum || 0;
						trig.sum += delta;

						// console.log('delta', delta)

						if (trig.sum > this.TRIGGER.LIMIT) {
							// console.log(' > viewed', link);

							this.storageSet(this.K.viewed + link, now.toString().split(' GMT').shift());

							this.feeds.forEach(feed => {
								let found = feed.items.find(x => x.link == link);

								if (!found) return;

								found.viewed = this.storageGet(this.K.viewed + link);
							});
						} else {
							trig.tic = trig.toc;
							// console.log(' > reset', link);
						}
					}
				break;
			}

			this.TRIGGER[link] = trig;
		},

		async loadFeedsWithContent({limit=this.K.LIMIT, limit_adjust=0, init_urls, force_update}) {
			if (this.loading && !force_update) return;

			this.loading = true;
			this.error = null;

			console.log('loadFeedsWithContent');

			try {
				let urls = init_urls || (this.params?.urls?.length ? this.params?.urls?.split(',') : this.tasks?.map(x => x.url));

				let data = urls?.length ? await Promise.allSettled(urls.map(url => new Promise(resolve => {
					if (force_update) return resolve({url});

					let key_nofetch = this.K.noClientFetch + new URL(url).hostname;

					if (this.storageGet(key_nofetch)) return resolve({url});
					try {
						fetch(url.replaceAll(' ', '+'), {redirect: 'follow', signal: AbortSignal.timeout(5e3)})
							.then(resp => resp.text())
							.then(content => resolve({url, content}))
							.catch(ex => resolve({url}))
					} catch (ex) {
						this.storageSet(key_nofetch, true);
						resolve({url})
					}
				}))) : [];

				data = data.map(x => x.value);

				if (!this.params?.hash && data.length) {
					let hash_local = await this.digest(JSON.stringify(data) + Date.now());
					this.params.hash = hash_local.slice(0, 6);
					this.storageSet(this.K.hash, this.params.hash);
				}

				console.log('datas:', data);

				let parallel = await Promise.allSettled(
					(force_update || !data?.length)
					? [
						fetch(`/api/feeds?limit=${limit}&hash=${this.params.hash || ''}`, {
							method: 'POST',
							headers: {"content-type": "application/json"},
							signal: AbortSignal.timeout(20e3),
							body: JSON.stringify({batch: data, update: force_update}),
						})
						.then(resp => resp.json())
						.catch(null)
					]
					: data.map((item, idx) =>
						fetch(`/api/feeds?limit=${limit + limit_adjust}&hash=${this.params.hash || ''}`, {
							method: 'POST',
							headers: {"content-type": "application/json"},
							signal: AbortSignal.timeout(20e3),
							body: JSON.stringify({keys :[item], batch: data}),
						})
						.then(resp => resp.json())
						.then(json => {
							// console.log('fetched', idx, item, json);
							return json;
						})
						.catch(null)
					)
				);

				// console.log('feeds:', parallel);

				let respFeeds = parallel.filter(p => p.status == 'fulfilled').map(p => p.value?.feeds || [])
								.flat().filter(x => x);

				console.log('respFeeds:', respFeeds);

				if (this.feeds?.length && !respFeeds?.length) {
					this.loading = false;
					return console.log("EEMPTYRESPFEEDS");
				}

				// merge articles
				respFeeds.forEach(feed => {
					let curFeed = this.feeds?.find?.(f => f.rss_url == feed.rss_url);

					if (!curFeed) return;

					feed.items.forEach(item => {
						let curItem = curFeed.items?.find?.(x => x.link == item.link);

						if (!curItem?.article) return;

						item.viewed = curItem.viewed;
						item.article = curItem.article;
					});
				});

				this.feeds = respFeeds;
				this.loading = false;

				let hash_server = parallel.find(p => p.status == 'fulfilled')?.value?.hash;
				if (hash_server) {
					const url = new URL(location);
					url.searchParams.delete("urls");
					url.searchParams.set("hash", hash_server);
					history.pushState({}, "", url);
					this.params.hash = hash_server;
					this.storageSet(this.K.hash, this.params.hash);
				}

				if (!this.feeds.length) return console.log("EEMPTYFEEDS");

				let {count} = this.postProcessFeeds({limit, auto_fetch_content: true});

				if (this.params.hash) {
					this.storageSet(this.K.feeds + this.params.hash, this.feeds);
					this.storageDel(this.K.feeds);
				} else {
					this.storageSet(this.K.feeds, this.feeds);
				}

				if (limit_adjust == 0 && count > 0) {
					await this.loadFeedsWithContent({limit, limit_adjust: count});
				}

				this.tasks = (!data?.length)
					? this.feeds.map((x, i) => ({url: x.rss_url, order: i, checked: false}))
					: data.map((x, i) => ({url: x.url, order: i, checked: false}));

				if (this.params.hash) {
					this.storageSet(this.K.tasks + this.params.hash, this.tasks);
					this.storageDel(this.K.tasks);
				} else {
					this.storageSet(this.K.tasks, this.tasks);
				}

				console.log(this.tasks);
			} catch (error) {
				console.error("Error fetching feeds:", error);
				this.error = "Failed to load feeds. Please check the server logs for more details";
				this.loading = false;
			} finally {
				console.log('loadFeedsWithContent.done');
			}
		},

		async digest(txt, algo='SHA-256') {
			return Array.from(
				new Uint8Array(await crypto.subtle.digest(algo, new TextEncoder().encode(txt))),
				(byte) => byte.toString(16).padStart(2, '0')
			).join('');
		},

		isElementInViewport(el) {
			if (typeof jQuery === "function" && el instanceof jQuery) {
				el = el[0];
			}

			let rect = el.getBoundingClientRect();

			return (
				rect.top >= 0 &&
				rect.left >= 0 &&
				rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) && /* or $(window).height() */
				rect.right <= (window.innerWidth || document.documentElement.clientWidth) /* or $(window).width() */
			);
		},

		decodeHTML(html) {
			var txt = document.createElement('textarea');
			txt.innerHTML = html;
			let decoded = txt.value;
			delete txt;
			return decoded;
		},

		timeSince(date) {
			let seconds = Math.floor((new Date() - date) / 1000);

			let interval = seconds / 31536000;

			if (interval > 1) {
				return Math.floor(interval) + " yr";
			}
			interval = seconds / 2592000;
			if (interval > 1) {
				return Math.floor(interval) + " mth";
			}
			interval = seconds / 86400;
			if (interval > 1) {
				return Math.floor(interval) + " day";
			}
			interval = seconds / 3600;
			if (interval > 1) {
				return Math.floor(interval) + " hr";
			}
			interval = seconds / 60;
			if (interval > 1) {
				return Math.floor(interval) + " min";
			}
			return Math.floor(seconds) + " sec";
		},

		postProcessFeeds({limit=this.K.LIMIT, auto_fetch_content=false}) {
			let count = 0;

			if (!this.feeds?.length) return {count};

			this.feeds.forEach((feed, feedIdx) => {
				if (!feed?.items?.length) return;

				feed.anchor = feed.title?.replace(/[^a-zA-Z0-9]/gi,'').toLowerCase();

				let len_full = feed.items.length;

				feed.items = feed.items.filter(item => {
					let {link} = item;

					if (item.description?.includes('<') || ~item.description?.search(/\&\w+\;/)) {
						item.description = new DOMParser().parseFromString(item.description, "text/html")?.documentElement.textContent;
					}

					item.description = item.description
						?.replace(/\<\/?[^>]*\>/g, '\n\n')
						.replace(/\n\n+/g, '\n\n')
						.replace(/\s+/g, ' ')
						.substr(0, 400)
						.trim()
					|| '';

					if (len_full <= limit) return true;

					let viewed = this.storageGet(this.K.viewed + link);

					if (viewed) return false;

					// console.log(' > skip', link)

					return true;
				});

				let len_filter = feed.items.length;
				let delta = Math.abs(len_full - len_filter);
				count = Math.max(count, delta);

				feed.items = feed.items.slice(0, limit);

				feed.items.forEach(item => {
					item.read_more = false;
					item.prefetching = false;

					item.toggleReadmore = () => {
						item.read_more = !item.read_more;

						if (item.read_more) {
							feed.read_more_item = item;
							feed.read_more = true;
							feed.article = item.article;

							feed.items.filter(x => x.link != item.link).forEach(x => x.read_more = false);

							this.storageSet(this.K.viewed + item.link, new Date().toString().split(' GMT').shift());

							setTimeout(() => {
								let fa = document.querySelector('#rss-feed-article-' + feedIdx);

								if (window.getComputedStyle(fa).display == 'none') return;

								fa.scrollIntoView(true)
							}, 0.1e3)

							let intervalImg = setInterval(() => {
								let doms = [...document.querySelectorAll('p.rss-article-content img')]
									.filter(x => x.complete && (x.naturalHeight == 0));

								if (doms.length == 0) return clearInterval(intervalImg);

								doms.forEach(x => x.remove())
							}, 0.3e3);

							item.updatePersona?.();
						} else {
							feed.read_more = false;
							feed.read_more_item.read_more = false;

							setTimeout(() => {
								let ia = document.querySelector(`a[href="${item.link}"]`);

								if (window.getComputedStyle(ia).display == 'none') return;

								ia.scrollIntoView(true)
							}, 0.1e3)
						}
					};

					item.prefetchContent = async () => {
						if (this.params?.style?.includes?.('nopreview')) return;

						// console.log('prefetchContent', item.title);

						if (!auto_fetch_content || item.article?.content || item.prefetching) return;
						item.prefetching = true;

						let resp = null;
						let opts = {redirect: 'follow'};
						let key_nofetch = this.K.noClientFetch + new URL(item.link).hostname;

						let noClientFetch = this.storageGet(key_nofetch);
						try {
							resp = noClientFetch
									? await fetch(`/html?urls=${encodeURIComponent(item.link)}`, opts).catch(null)
									: await fetch(item.link, opts).catch(null);
						} catch (ex) {
							this.storageSet(key_nofetch, true);
							resp = await fetch(`/html?urls=${encodeURIComponent(item.link)}`, opts).catch(null);
						}

						// item.prefetching = false;

						if (resp.status >= 400) return /*console.log(item.link, resp)*/;

						let html = await resp?.text?.().catch(null);

						if (!html) return;

						let doc = new DOMParser().parseFromString(html, "text/html");
						item.article = new Readability(doc).parse();

						let content = item.article?.content;
						if (content?.length) {
							item.article.content = content
								.trim()
								.replace(/<(?!img|table|th|td|tr|p|i|ul|li|h1|h2|h3|h4|h5|h6)[^>]+>/gi, '\n').replace(/<\s*\/\s*[^>]*>/gi, '\n')
								.replace(/\n\n+/gi, '\n\n').trim().replace(/\n\n+/gi, '<br>')
								.replace(/^(\<br\>)+/gi, '').replace(/(\<br\>)+$/gi, '')
								.replace(/(\<br\>\s*\n*)+/gi, '<br>')
								.replace(/\s+/gi, ' ');
						}
					};

					if (feedIdx <= 1) {
						item.prefetchContent();
						this.triggerIntersect('full', item.link);
					}

					item.updatePersona = async () => {
						item.vector = item.vector || await this.embedSentence(item.title);

						// console.log('updatePersona', item.vector)

						if (item.vector) {
							// console.log('currentPersona', this.persona);

							if (!Array.isArray(this.persona?.vector) || (item.vector.length != this.persona.vector.length)) {
								this.persona = {vector: item.vector, count: 1};
								this.storageSet(this.K.persona, this.persona);
							} else {
								let similarity = this.similarity(item.vector, this.persona.vector);
								console.log('similarity', similarity);

								let newVector = this.updateMeanVector(this.persona.vector, this.persona.count, item.vector);
								// console.log('newVector', newVector);

								if (newVector) {
									this.persona = 	{vector: newVector, count: this.persona.count + 1};
									this.storageSet(this.K.persona, this.persona);
								}
							}

							// console.log('updatePersona', this.persona);
						}
					};

					this.embedSentence(item.title).then(v => {
						if (!v) return;

						item.vector = v;

						if (Array.isArray(this.persona?.vector)) {
							let similarity = this.similarity(item.vector, this.persona.vector);

							item.author = similarity ? Number(similarity).toFixed(2) : item.author;
						}
					});
				})
			});

			setTimeout(() => {
				let hrefs = [...document.querySelectorAll('a.rss-thumb,a.rss-title')]
					.filter(x => this.isElementInViewport(x))
					.map(a => a.href)
					.filter(x => x);
				// console.log('hrefs', hrefs);

				this.feeds?.forEach?.(feed => feed.items?.filter?.(x => hrefs.includes(x.link)).forEach(x => x.prefetchContent?.()));
			}, 0.5e3);

			return {count};
		},

		async reviewTask() {
			try {
				let urls = this.input?.split(',').map(x => {
					let url = new URL(x.trim()).toString();

					return {url};
				});

				let data = await fetch(`/api/feeds?limit=6`, {
					method: 'POST',
					headers: {"content-type": "application/json"},
					signal: AbortSignal.timeout(20e3),
					body: JSON.stringify({keys: urls}),
				})
				.then(resp => resp.json())
				.catch(null);

				if (!data) return;

				// console.log({data});
				this.review_feed = data.feeds[0];

				console.log({review_feed: this.review_feed});
			} catch (ex) {
				console.log(ex.message);
			}
		},

		addNewTask() {
			try {
				this.input?.split(',').forEach(x => {
					let url = new URL(x.trim()).toString();

					let found = this.tasks.find(x => x?.url == url);

					if (found) return;

					this.tasks.push({ url, order: this.tasks.length, checked: false });
				});

				this.storageSet(this.K.tasks, this.tasks);
				if (this.params.hash) {
					this.storageSet(this.K.tasks + this.params.hash, this.tasks);
					this.storageDel(this.K.tasks);
				}

				this.input = '';
				this.review_feed = null;
			} catch (ex) {
				console.error(ex.message);
			}
		},

		importDefaults() {
			try {
				this.tasks.push(...this.K.DEFAULTS.map((x, i) => ({url: x, order: i, checked: false})));

				if (this.params.hash) {
					this.storageSet(this.K.tasks + this.params.hash, this.tasks);
				} else {
					this.storageSet(this.K.tasks, this.tasks);
				}
			} catch (ex) {
				console.error(ex.message);
			}
		},

		clearAllTasks() {
			this.input = '';
			this.tasks = [];
			this.storageDel(this.K.tasks, '');
			this.storageDel(this.K.tasks + this.params.hash, '');
		},

		exportTasks() {
			let encodedUrls = this.tasks?.map?.(x => x.url).join(',\n');
			let filename = `${this.params.hash || 'feeds'}.csv`;

			const blob = new Blob([encodedUrls], {type: 'text/csv'});

			if(window.navigator.msSaveOrOpenBlob) {
				window.navigator.msSaveBlob(blob, filename);
			} else {
				const elem = window.document.createElement('a');
				elem.href = window.URL.createObjectURL(blob);
				elem.download = filename;
				document.body.appendChild(elem);
				elem.click();
				document.body.removeChild(elem);
			}
		},

		buildTasks() {
			let encodedUrls = this.tasks?.map?.(x => encodeURIComponent(x.url)).join(',');

			let limit = this.params?.limit || this.K.LIMIT;

			this.loading = true;
			this.storageSet(this.K.tasks, this.tasks);
			if (this.params.hash) {
				this.storageSet(this.K.tasks + this.params.hash, this.tasks);
				this.storageDel(this.K.tasks);
			}

			window.scrollTo({ top: 0, behavior: 'smooth' });

			this.loadFeedsWithContent({limit, force_update: true, init_urls: this.tasks?.map(x => x.url)})
				.then(done => {
					console.log('build tasks done');
					this.loading = false;
					window.open(`/?limit=${limit}&hash=${this.params.hash||''}`, '_self')
				});
		},

		async embedSentence(text) {
			if (!window.embedder) return null;
			const vector = await window.embedder(text, { pooling: 'mean', normalize: true });
			return vector?.data;
		},

		toggleDarkMode() {
			if (document.documentElement.classList.contains('dark')) {
				document.documentElement.classList.remove('dark')
				localStorage.setItem('theme', 'light');
				this.dark = false;
			} else {
				document.documentElement.classList.add('dark')
				localStorage.setItem('theme', 'dark');
				this.dark = true;
			}
		},

		async init() {
			// console.log('init')

			if ( localStorage.getItem('theme') === 'dark' ||
				 (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
			) {
				document.documentElement.classList.add('dark');
				this.dark = true;
			} else {
				document.documentElement.classList.remove('dark');
				this.dark = false;
			}

			this.$watch('loading', value => {
				this.title = this.theTitle();
			});

			this.params = Object.fromEntries(new URLSearchParams(location.search));
			this.params.hash = this.params.hash || this.storageGet(this.K.hash);
			this.params.style = this.params.style || this.storageGet(this.K.style);

			let limit = this.params?.limit || this.K.LIMIT;

			this.ready = true;
			this.loading = true;

			this.storageSet(this.K.style, this.params.style);
			console.log('inited params', this.params)

			this.tasks = this.storageGet(this.K.tasks) || [];
			console.log('inited tasks_0', this.tasks.length)

			if (this.params.hash)
				this.tasks = this.storageGet(this.K.tasks + this.params.hash) || this.tasks;
			console.log('inited tasks', this.tasks.length)

			this.feeds = this.storageGet(this.K.feeds) || [];
			console.log('inited feeds_0', this.feeds.length, this.params.hash, this.storageGet(this.K.feeds + this.params.hash))

			if (this.params.hash && this.storageGet(this.K.feeds + this.params.hash))
				this.feeds = this.storageGet(this.K.feeds + this.params.hash) || this.feeds;

			this.postProcessFeeds({limit});
			console.log('inited feeds', this.feeds.length)

			this.loading = false;

			this.loadFeedsWithContent({limit})
				.then(done => {
					if (!this.tasks?.length) {
						this.tasks = this.K.DEFAULTS.map((x, i) => ({url: x, order: i, checked: false}));
						console.log('default tasks', this.tasks.length)
					}
				})
				.catch(null);
			console.log('inited contents')

			if (this.storageGet(this.K.persona)) {
				this.persona = this.storageGet(this.K.persona);

				// console.log('init', this.persona)

				if (typeof this.persona.vector == 'object') {
					this.persona.vector = Object.values(this.persona.vector);
				}
			}
			console.log('inited persona')

			Object.entries({...localStorage})
				.filter(
					([k, v]) => ( k.includes(this.K.viewed) && (new Date(v) < new Date(Date.now() - 24*60*60e3)) )
							|| ( Number(k.split('_').shift().replace('v', '')) < Number(VERSION.replace('v', '')) )
				)
				.forEach( ([k, v]) => localStorage.removeItem(k) )
			;
			console.log('inited old localStorage')

			let this_params = this.params;
			let editor_options = new JSONEditor(document.getElementById('json-editor'), {
				schema: {
					type: "object",
					title: "RSS Options",
					properties: {
						hash: {
							type: "string",
							title: "Hash Identity",
							default: this.params.hash,
						},
						limit: {
							type: "integer",
							title: "Items per Feed",
							enum: [ 3, 6, 9, 12, 15, 20, 24, 30, 36, 48, 64, 100 ],
							default: this.params.limit || this.K.LIMIT,
						},
						style: {
							type: "string",
							title: "Display Style",
							enum: [
								"default",
								"full",
								"nopreview",
								"noimg",
								"title",
							],
							default: this.params.style || 'default',
						},
					}
				},
				theme: 'bootstrap4',
				disable_collapse: true,
				disable_edit_json: true,
				disable_properties: true,
				no_additional_properties: true,
			});
			document.getElementById('json-editor-submit').addEventListener('click', function () {
				let opts = editor_options.getValue();

				const url = new URL(location);
				Object.entries(opts).forEach( ([k, v]) => {
					url.searchParams.set(k, v);
					this_params[k] = v;
				});
				history.pushState({}, "", url);
			});
			this.editor_options = editor_options;
			console.log('inited editor')

			// setInterval(async () => {
			// 	const vector2 = await window.embedder?.('this is text', { pooling: 'mean', normalize: true })
			// 	console.log('vector2', vector2);
			// }, 10e3);
		},
	}
};

navigator?.serviceWorker?.register?.('sw.js');
</script>

 
<!-- <link rel="preload" as="script" href="//cdn.jsdelivr.net/npm/@huggingface/transformers@3.3.3" /> -->
<script type="module">
// import { pipeline } from 'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.3.3';

try {
	/*const embedder = await pipeline('feature-extraction', 'Xenova/all-MiniLM-L6-v2');
	const vector = await embedder('rss');

	if (embedder) {
		window.embedder = embedder;
		console.log('window.embedder is loaded');
	}*/

	/*const translator = await pipeline('translation', 'Xenova/nllb-200-distilled-600M');
	const translated = await translator('We just decided: The first step in fixing the world is to Be Informed. Get curated news, delivered your way: fast, personalized RSS.', {
	  src_lang: 'eng_Latn',
	  tgt_lang: 'vie_Latn',
	});
	console.log({translated});*/

	/*const translator = await pipeline('translation', 'Xenova/m2m100_418M');
	const translated = await translator('We just decided: The first step in fixing the world is to Be Informed. Get curated news, delivered your way: fast, personalized RSS.', {
	  src_lang: 'en',
	  tgt_lang: 'vi',
	});
	console.log({translated});*/
} catch (ex) { console.log(ex) }
</script>

